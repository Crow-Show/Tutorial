[Передача параметров по ссылке](https://metanit.com/sharp/tutorial/2.27.php)    
[Парамс](https://metanit.com/sharp/tutorial/2.10.php)

# Передача параметров в метод.
Методы по-разному работают со ссылочным и значимыми типами данных.

### Значимые
Передаются в метод как копия. Это расходует лишнюю память на копию параметра, что может быть критично для больших
структур. Но полностью защищают внешний параметр от изменения внутри метода. Любые манипуляции с аргументом внутри
метода не влияют на сам внешний параметр. Только на копию в методе.
```
int x = 5;

void Sum(int x) 
{
x = x + x;
Console.Write(x);   //10
}

Console.Write(x);   //5
```
### Ссылочные
Ссылочные типы передают в метод именно **ссылку на значение**. **Она и защищена** от редактирования. Само же **значение
может быть изменено** внутри метода. Ярчайший пример - **массив**. **Изменение** любой **ячейки массива** внутри метода
**изменит сам массив**, а не только копию, как у значимых типов.
```
int[] x = {5};

void Sum(int[] x) 
{
x[0] = x[0] + x[0];
Console.Write(x[0]);    //10

x[] = new x[4]          //ошибка. ссылка на массив защищена от изменения
}

Console.Write(x);       //10
```
# Передача параметров по ссылке
Есть несколько способов передать ссылку на исходный аргумент, а не копию, чтобы метод мог напрямую работать с внешним
значением.

## out
### Запись
`TryParse("строка", out переменная)`

### Принцип работы
**out** позволяет передать в метод ссылку на внешний параметр для того, чтобы **записать в нее значение**. Метод **не
может прочитать** текущее значение параметра. Но **должен записать** в него новое. Если в методе с аргументом out ему не
будет присвоено значение, метод будет выдавать ошибку.

### Работы со значимыми/ссылочными типами
**Значимые**: передает ссылку на само **значение**. Метод **обязан** его **записать**.
**Ссылочные**: метод **обязан записать** именно ссылку и **только ссылку**. Задать длину массива, инициализировать
структуру, присвоить ссылку на класс.

### Назначение
В **99%** случае используется для **парсеров** и прочих **TryXXX методов**.

### Примечание по использованию
Все остальные способы применения скорее всего не верны и могут быть заменены на более подходящие.

## ref
### Запись
```
void AddBonus(ref int score) { score += 10; }
AddBonus(ref score);
```
### Принцип работы
Передает значение по ссылке, **позволяя как читать, так и редактировать** внешний параметр. Фактически дает к нему *
*полный доступ**.

### Работы со значимыми/ссылочными типами
**Значимые**: **передает методу полный доступ** к внешней переменной
**Ссылочные**: передает **полный доступ к ссылке**. значение и так **можно было редактировать**. Может перепривязать
массив к другой ссылке, например.

### Назначение
Используется для **очень редких** случаев, когда **метод должен одновременно и читать и редактировать значение**, при
том его**неудобно вернуть через return**. Либо этих **значений несколько**.

### Примечание по использованию

Для **ссылочных** типов практически **бесполезен**. В целом **редко применим**, **не** слишком хорошо **читаем** и дает
методу **слишком много прав**. Скорее всего не нужен. А если нужен - **должна быть веская причина**.

## in
### Запись
`void PrintDistanceFromOrigin(in Point p)`

### Принцип работы
Передает компилятору **не строгое сообщение не копировать** аргумент, а взять его по ссылке. **Запрещает редактирование**.
Оставляет доступ только для чтения.

### Работы со значимыми/ссылочными типами
**Значимые**: передача по ссылке только для чтения
**Ссылочные**: фактически ничего

### Назначение
Основная задача - **экономия места** при передаче **больших структур** в метод. Также **сообщает читающему**, что
параметр передан **только для чтения**.

### Примечание по использованию
**Компилятор может все равно копировать аргумент, если посчитает более оптимальным**. Бесполезен для маленьких типов,
вроде int, char и тд. А также ссылочных типов. Фактически нужен **только для структур**.

## ref readonly
### Запись
`void PrintSum(ref readonly BigData data)`

### Принцип работы
**Жесткий запрет на копирование и изменение**.

### Работы со значимыми/ссылочными типами
**Значимые**: **100% передача по ссылке** и запрет редактирования
**Ссылочные**: фактически ничего

### Назначение
**Гарантировать** передачу **по ссылке** структуры. Используется там, где **важно строгая передача по ссылке** без
редактирования. К примеру в **высокопроизводительном коде**.

### Примечание по использованию
Строго обозначает задачу метода своим наличием. Нужен редко и **требует серьезного обоснования**.

# params
### Запись
```
void Sum(params int[]  numbers)
Sum();
Sum(1);
Sum(1, 2, 5);
```
### Принцип работы
**Позволяет** передать в метод **неограниченное количество однотипных значений** в метод в виде **одномерного массива**.
**От 0 до бесконечности**.

### Ограничения
Может быть достаточно **опасен и непредсказуем**:

1. Должен быть записан последним в списке аргументов. Иначе компилятор не сможет увидеть где заканчивается массив и
   начинается другой аргумент.
2. В связи с первым пунктом может быть только один на метод.
3. Может по-разному реагировать на null в зависимости от кода. Стоит проявлять осторожность.
4. Непредсказуемо реагирует на перегрузку, особенно если один метод имеет params, а другой нет.
5. Всегда создает массив, даже если передано одно значение или не передано вообще.
6. Не совместим с ref и out.

### Назначение
Используется либо для передачи в метод **одноразовых значений**, например для суммирования, либо для методов **формата "
найти совпадение по списку"** когда число значений не определено.

### Примечание по использованию
**params** - скорее про синтаксис, чем про архитектуру. Передает **мало информации** читающему и **не защищен от**
многих **ошибок**. Почти всегда лучше использовать другие инструменты, кроме вышеописанных ситуаций.